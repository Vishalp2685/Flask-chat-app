<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <title>
    Chat Interface
  </title>
  <script src="https://cdn.tailwindcss.com">
  </script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&amp;display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="D:/python_projects/Flask/chat app/static/chat.css">
  <style>
   body {
      font-family: 'Inter', sans-serif;
      background-color: #070909;
      /* margin: 30px; */
    }
    /* Scrollbar for chat messages */
    .scrollbar-thin::-webkit-scrollbar {
      width: 6px;
    }
    .scrollbar-thin::-webkit-scrollbar-track {
      background: transparent;
    }
    .scrollbar-thin::-webkit-scrollbar-thumb {
      background-color: rgba(107, 114, 128, 0.5);
      border-radius: 3px;
    }
    .friend_button:hover{
      background-color: #181c21;
    }
  </style>
 </head>
 <body>
  <!-- <div>
    <button name="logout" style="border: 2px solid red; border-radius: 10px; margin: 20px; padding: 10px 30px; background-color: rgb(255, 165, 0);">Logout</button>
  </div> -->
  <div class="flex md:flex-row max-w-7xl mx-auto overflow-hidden" style="height: 870px; margin: 50px auto auto auto; border-radius: 30px; border: 2px solid rgba(128, 128, 128, 0.505); background-color: #080A0F;">
   <!-- Sidebar: Contacts -->
   <div style="border-right:1px solid rgba(128, 128, 128, 0.223); background-color: #080A0F;">
    <img style="margin: 15px auto 0 auto" alt="User profile picture, a placeholder avatar with letter U on green background" class="rounded-full" height="40" src="{{ url_for('static', filename='avatar.jpg') }}" width="60"/>
    <div style="margin-top:720px;">
      <button name="logout" style="color: white; font-weight:bolder; border-radius: 50px; margin: auto 15px 0 15px ;padding: 10px 20px; background-color: #ff0004a5;">Logout</button>
    </div>
  </div>
   <aside class="flex flex-col" style="border-right:1px solid rgba(128, 128, 128, 0.223);">
    <header class="flex items-center justify-between px-4 py-3" style="border-bottom:1px solid rgba(128, 128, 128, 0.223);padding: 16px;">
     <div class="flex items-center space-x-3">
      <!-- <img alt="User profile picture, a placeholder avatar with letter U on green background" class="rounded-full" height="40" src="https://storage.googleapis.com/a1aa/image/d01a8a19-f525-4516-d34d-8c282a349194.jpg" width="40"/> -->
      <h1 class="font-semibold" style="color: white; font-size:25px; padding: 1px;">
       {{session['user_name']}}
      </h1>
     </div>
     <button name="new_chat" aria-label="New chat" class="text-gray-600 hover:text-gray-800 focus:outline-none focus:ring-2 focus:ring-green-500 rounded">
      <i class="fas fa-comment-alt fa-lg">
      </i>
     </button>
    </header>
    <div class="px-4 py-3">
     <input style="border-radius: 15px; background-color: #0F1215; height:fit-content;" aria-label="Search contacts" class="w-full px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="Search or start new chat" type="search"/>
    </div>
    <nav class="flex-1 overflow-y-auto scrollbar-thin">
     <ul>
      {% for friend in friends %}
      <li>
        <form action="/loadchat/{{friend.get('friend_id')}}" method="POST">
        <button value="{{user_id}}" aria-current="true" class="w-full flex items-center space-x-3 px-4 py-3 focus:outline-none focus:bg-gray-100 friend_button">
         <img alt="Contact profile picture, placeholder avatar with letters AL on blue background" class="rounded-full" height="48" src="{{ url_for('static', filename='avatar.jpg') }}" width="48"/>
         <div class="flex-1 text-left">
          <div class="flex justify-between items-center">
           <p class="font-semibold" style="color: white;">
            {{friend.get('first_name')}}
           </p>
           <!-- <time class="text-xs text-gray-500">
            {{friend.get('last_message_time')}} 
           </time> -->
          </div>
          <!-- <p class="text-sm text-gray-600 truncate">
           {{friend.get('last_message')}}
          </p> -->
         </div>
        </button>
       </li>
      </form>
      {% endfor %}
     </ul>
    </nav>
   </aside>
   <!-- Chat area -->
   <section class="flex-1 flex flex-col" >
    <header class="flex items-center px-4 py-3" style="border-bottom:1px solid rgba(128, 128, 128, 0.223)">
     <img alt="Chat contact profile picture, placeholder avatar with letters AL on blue background" class="rounded-full" height="48" src="{{ url_for('static', filename='avatar.jpg') }}" width="48"/>
     <div class="ml-3 flex-1">
      <h2 class="text-lg font-semibold" style="color: white;">
       {{name}}
      </h2>
      <p class="text-sm text-green-600">
       online
      </p>
     </div>
     <button aria-label="Call" class="text-gray-600 hover:text-gray-800 focus:outline-none focus:ring-2 focus:ring-green-500 rounded p-2">
      <i class="fas fa-phone fa-lg">
      </i>
     </button>
     <button aria-label="Video call" class="ml-2 text-gray-600 hover:text-gray-800 focus:outline-none focus:ring-2 focus:ring-green-500 rounded p-2">
      <i class="fas fa-video fa-lg">
      </i>
     </button>
     <button aria-label="More options" class="ml-2 text-gray-600 hover:text-gray-800 focus:outline-none focus:ring-2 focus:ring-green-500 rounded p-2">
      <i class="fas fa-ellipsis-v fa-lg">
      </i>
     </button>
    </header>
    <main aria-label="Chat messages" class="flex-1 overflow-y-auto p-4 space-y-4 scrollbar-thin" style="background-color: #05090B;">
      {% for message in messages %}
        {% if message.get('sender_id') != session['user_id'] %}
     <div class="flex items-start space-x-3 max-w-xs">
      <img alt="Alice L. profile picture, placeholder avatar with letters AL on blue background" class="rounded-full mt-1" height="32" src="{{ url_for('static', filename='avatar.jpg') }}" width="32"/>
      <div>
       <div class="bg-white text-gray-900 p-3 rounded-lg rounded-bl-none shadow">
        {{message.get('content')}}
       </div>
       <time class="block text-xs text-gray-400 mt-1 ml-1">
        {{message.get('created_at')}}
       </time>
      </div>
     </div>
     {% endif %}
     {% if message.get('sender_id') == session['user_id'] %}
     <div class="flex justify-end max-w-xs ml-auto items-start space-x-3 ">
      <div>
       <div class="bg-green-500 text-white p-3 rounded-lg rounded-br-none shadow">
        {{message.get('content')}}
       </div>
       <time class="block text-xs text-gray-400 mt-1 text-right">
        {{message.get('created_at')}}
       </time>
      </div>
      <img alt="User profile picture, a placeholder avatar with letter U on green background" class="rounded-full mt-1" height="32" src="{{ url_for('static', filename='avatar.jpg') }}" width="32"/>
     </div>
     {% endif %}
     {% endfor %}
    </main>

    <form method="POST" aria-label="Send message form" class="px-4 py-3 flex items-center space-x-3" style="border-top: 1px solid rgba(128, 128, 128, 0.223);">
     <button name="emoji" aria-label="Add emoji" class="text-gray-600 hover:text-gray-800 focus:outline-none focus:ring-2 focus:ring-green-500 rounded p-2" type="button">
      <i class="far fa-smile fa-lg">
      </i>
     </button>
     <button name="attach-file" aria-label="Attach file" class="text-gray-600 hover:text-gray-800 focus:outline-none focus:ring-2 focus:ring-green-500 rounded p-2" type="button">
      <i class="fas fa-paperclip fa-lg">
      </i>
     </button>
     <input name="message" style="background-color: #0F1215; border-radius: 50px; border: 1px solid rgba(128, 128, 128, 0.223);" aria-label="Message input" class="flex-1 rounded-full px-4 py-2 focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="Type a message" type="text"/>
     <button aria-label="Send message" class="bg-green-500 hover:bg-green-600 text-white rounded-full p-2 focus:outline-none focus:ring-2 focus:ring-green-500" type="submit">
      <i class="fas fa-paper-plane fa-lg">
      </i>
     </button>
    </form>
   </section>
  </div>
 </body>
</html>
