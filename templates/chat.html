<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <title>
    Chat Interface
  </title>
  <script src="https://cdn.tailwindcss.com">
  </script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&amp;display=swap" rel="stylesheet"/>
  <style>
   body {
      font-family: 'Inter', sans-serif;
    }
    /* Scrollbar for chat messages */
    .scrollbar-thin::-webkit-scrollbar {
      width: 6px;
    }
    .scrollbar-thin::-webkit-scrollbar-track {
      background: transparent;
    }
    .scrollbar-thin::-webkit-scrollbar-thumb {
      background-color: rgba(107, 114, 128, 0.5);
      border-radius: 3px;
    }
  </style>
 </head>
 <body class="bg-gray-100 h-screen flex flex-col">
  <div class="flex flex-col md:flex-row h-full max-w-7xl mx-auto w-full shadow-lg bg-white rounded-lg overflow-hidden">
   <!-- Sidebar: Contacts -->
   <aside class="w-full md:w-80 border-r border-gray-200 flex flex-col">
    <header class="flex items-center justify-between px-4 py-3 border-b border-gray-200">
     <div class="flex items-center space-x-3">
      <img alt="User profile picture, a placeholder avatar with letter U on green background" class="rounded-full" height="40" src="https://storage.googleapis.com/a1aa/image/d01a8a19-f525-4516-d34d-8c282a349194.jpg" width="40"/>
      <h1 class="text-xl font-semibold text-gray-800" style="color: black;">
       {{session['user_name']}}
      </h1>
     </div>
     <button name="new_chat" aria-label="New chat" class="text-gray-600 hover:text-gray-800 focus:outline-none focus:ring-2 focus:ring-green-500 rounded">
      <i class="fas fa-comment-alt fa-lg">
      </i>
     </button>
    </header>
    <div class="px-4 py-3 border-b border-gray-200">
     <input aria-label="Search contacts" class="w-full px-3 py-2 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="Search or start new chat" type="search"/>
    </div>
    <nav class="flex-1 overflow-y-auto scrollbar-thin">
     <ul>
      {% for friend in friends %}
      <li>
        <form action="/loadchat/{{friend.get('friend_id')}}" method="POST">
        <button value="{{user_id}}" aria-current="true" class="w-full flex items-center space-x-3 px-4 py-3 hover:bg-gray-100 focus:outline-none focus:bg-gray-100">
         <img alt="Contact profile picture, placeholder avatar with letters AL on blue background" class="rounded-full" height="48" src="https://storage.googleapis.com/a1aa/image/83132244-537e-4cda-c648-f4e1d2c7f982.jpg" width="48"/>
         <div class="flex-1 text-left">
          <div class="flex justify-between items-center">
           <p class="font-semibold text-gray-900">
            {{friend.get('first_name')}}
           </p>
           <!-- <time class="text-xs text-gray-500">
            {{friend.get('last_message_time')}} 
           </time> -->
          </div>
          <!-- <p class="text-sm text-gray-600 truncate">
           {{friend.get('last_message')}}
          </p> -->
         </div>
        </button>
       </li>
      </form>
      {% endfor %}
     </ul>
    </nav>
   </aside>






   <!-- Chat area -->
   <section class="flex-1 flex flex-col">
    <header class="flex items-center px-4 py-3 border-b border-gray-200">
     <img alt="Chat contact profile picture, placeholder avatar with letters AL on blue background" class="rounded-full" height="48" src="https://storage.googleapis.com/a1aa/image/2f2ec17b-a8b5-442f-ed87-353d46f431df.jpg" width="48"/>
     <div class="ml-3 flex-1">
      <h2 class="text-lg font-semibold text-gray-900">
       {{name}}
      </h2>
      <p class="text-sm text-green-600">
       online
      </p>
     </div>
     <button aria-label="Call" class="text-gray-600 hover:text-gray-800 focus:outline-none focus:ring-2 focus:ring-green-500 rounded p-2">
      <i class="fas fa-phone fa-lg">
      </i>
     </button>
     <button aria-label="Video call" class="ml-2 text-gray-600 hover:text-gray-800 focus:outline-none focus:ring-2 focus:ring-green-500 rounded p-2">
      <i class="fas fa-video fa-lg">
      </i>
     </button>
     <button aria-label="More options" class="ml-2 text-gray-600 hover:text-gray-800 focus:outline-none focus:ring-2 focus:ring-green-500 rounded p-2">
      <i class="fas fa-ellipsis-v fa-lg">
      </i>
     </button>
    </header>
    <main aria-label="Chat messages" class="flex-1 overflow-y-auto p-4 space-y-4 scrollbar-thin bg-gray-50">
      {% for message in messages %}
        {% if message.get('sender_id') != session['user_id'] %}
     <div class="flex items-start space-x-3 max-w-xs">
      <img alt="Alice L. profile picture, placeholder avatar with letters AL on blue background" class="rounded-full mt-1" height="32" src="https://storage.googleapis.com/a1aa/image/84980a54-87d9-49b0-7185-290d453d096c.jpg" width="32"/>
      <div>
       <div class="bg-white text-gray-900 p-3 rounded-lg rounded-bl-none shadow">
        {{message.get('content')}}
       </div>
       <time class="block text-xs text-gray-400 mt-1 ml-1">
        {{message.get('created_at')}}
       </time>
      </div>
     </div>
     {% endif %}
     {% if message.get('sender_id') == session['user_id'] %}
     <div class="flex justify-end max-w-xs ml-auto items-start space-x-3 ">
      <div>
       <div class="bg-green-500 text-white p-3 rounded-lg rounded-br-none shadow">
        {{message.get('content')}}
       </div>
       <time class="block text-xs text-gray-400 mt-1 text-right">
        {{message.get('created_at')}}
       </time>
      </div>
      <img alt="User profile picture, a placeholder avatar with letter U on green background" class="rounded-full mt-1" height="32" src="https://storage.googleapis.com/a1aa/image/d01a8a19-f525-4516-d34d-8c282a349194.jpg" width="32"/>
     </div>
     {% endif %}
     {% endfor %}
    </main>

    <form method="POST" aria-label="Send message form" class="border-t border-gray-200 px-4 py-3 flex items-center space-x-3">
     <button name="emoji" aria-label="Add emoji" class="text-gray-600 hover:text-gray-800 focus:outline-none focus:ring-2 focus:ring-green-500 rounded p-2" type="button">
      <i class="far fa-smile fa-lg">
      </i>
     </button>
     <button name="attach-file" aria-label="Attach file" class="text-gray-600 hover:text-gray-800 focus:outline-none focus:ring-2 focus:ring-green-500 rounded p-2" type="button">
      <i class="fas fa-paperclip fa-lg">
      </i>
     </button>
     <input name="message" aria-label="Message input" class="flex-1 border border-gray-300 rounded-full px-4 py-2 focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="Type a message" type="text"/>
     <button aria-label="Send message" class="bg-green-500 hover:bg-green-600 text-white rounded-full p-2 focus:outline-none focus:ring-2 focus:ring-green-500" type="submit">
      <i class="fas fa-paper-plane fa-lg">
      </i>
     </button>
    </form>
   </section>
  </div>
 </body>
 <script>
  const user_id = "{{session['user_id']}}";
  console.log(user_id)
</script>
</html>
